---
date: "2019-04-29T12:30:27-07:00"
draft: true
title: "Ubuntu-Manual"
tags: []
series: []
categories: []
toc: true
---
## Linux系统启动过程
1. 内核引导
   1. 计算机开启电源后
   2. BIOS开机自检
   3. 按照BIOS设置的启动设备来启动 
   4. 操作系统接管硬件
   5. 读取/boot目录下的内核文件
2. 运行init
   1. init 进程是系统所有进程的起点，第一个进程
   2. init 程序首先是需要读取配置文件 /etc/inittab。
3. 运行级别
   1. 许多程序需要开机启动。它们在Windows叫做"服务"（service），在Linux就叫做"守护进程"（daemon）
   2. init进程的一大任务，就是去运行这些开机启动的程序
   3. Linux允许为不同的场合，分配不同的开机启动程序，这就叫做"运行级别"（runlevel）。也就是说，启动时根据"运行级别"，确定要运行哪些程序。
   4. 运行级别0：系统停机状态，系统默认运行级别不能设为0，否则不能正常启动
   5. 运行级别1：单用户工作状态，root权限，用于系统维护，禁止远程登陆
   6. 运行级别2：多用户状态(没有NFS)
   7. 运行级别3：完全的多用户状态(有NFS)，登陆后进入控制台命令行模式
   8. 运行级别4：系统未使用，保留
   9. 运行级别5：X11控制台，登陆后进入图形GUI模式
   10. 运行级别6：系统正常关闭并重启，默认运行级别不能设为6，否则不能正常启动
4. 系统初始化
   1. rc.sysinit是一个bash shell的脚本，它主要是完成一些系统初始化的工作，
   2. rc.sysinit是每一个运行级别都要首先运行的重要脚本。
   3. 它主要完成的工作有：激活交换分区，检查磁盘，加载硬件模块以及其它一些需要优先执行任务。 
   4. 在每个运行级中将运行哪些守护进程，用户可以通过chkconfig或setup中的"System Services"来自行设定。
5. 建立终端
   1. rc执行完毕后，返回init。这时基本系统环境已经设置好了，各种守护进程也已经启动了。
   2. init接下来会打开6个终端，以便用户登录系统
6. 用户登录系统
   1. 命令行登录
   2. ssh登录
   3. 图形界面登录
   4. 如果用户名不是 root，且存在 /etc/nologin 文件，login 将输出 nologin 文件的内容，然后退出。
   5. 只有/etc/securetty中登记了的终端才允许 root 用户登录，如果不存在这个文件，则 root 用户可以在任何终端上登录。
   6. /etc/usertty文件用于对用户作出附加访问限制，如果不存在这个文件，则没有其他限制。
7. 图形模式与文字模式的切换方式
   1. 如果你安装了图形界面，默认情况下是进入图形界面的，此时你就可以按Ctrl + Alt + F1 ~ F6来进入其中一个命令窗口界面。
   2. 当你进入命令窗口界面后再返回图形界面只要按下Ctrl + Alt + F7 就回来了。
   3. 如果你用的vmware 虚拟机，命令窗口切换的快捷键为 Alt + Space + F1~F6. 如果你在图形界面下请按Alt + Shift + Ctrl + F1~F6 切换至命令窗口。 
8. Linux 关机
   1. 正确的关机流程为：sync > shutdown > reboot > halt
   2. 关机指令为：shutdown 
   3. reboot 就是重启，等同于 shutdown –r now
   4. halt 关闭系统，等同于shutdown –h now 和 poweroff
   5. halt 命令通知硬件来停止所有的 CPU 功能，但是仍然保持通电。你可以用它使系统处于低层维护状态。
   
## 图片编辑
- 打开一张图片右键
- 在照片上右键单击-->打开方式-->Shotwell Viewer
- 在预览框下方找到裁减

## 网络排错
### Ping
它所利用的原理是这样的:网络上的机器都有唯一确定的IP地址， 我们给目标IP地址发送一个数据包，对方就要返回一个同样大小的数据包，根据返回的数据包我们可以确定目标主机的存在，可以初步判断目标主机的操作系统 等。
1. Request timed out
   1.  对方已关机，或者网络上根本没有这个地址：比如在上图中主机A中PING 192.168.0.7 ，或者主机B关机了，在主机A中PING 192.168.0.5 都会得到超时的信息。
   2.  对方与自己不在同一网段内，通过路由也无法找到对方，但有时对方确实是存在的，当然不存在也是返回超时的信息。
   3.  对方确实存在，但设置了ICMP数据包过滤（比如防火墙设置）。怎样知道对方是存在，还是不存在呢，可以用带参数 -a 的Ping命令探测对方，如果能得到对方的NETBIOS名称，则说明对方是存在的，是有防火墙设置，如果得不到，多半是对方不存在或关机，或不在同一网段内。
   4.  错误设置IP地址,正常情况下，一台主机应该有一个网卡，一个IP地址，或多个网卡，多个IP地址（这些地址一定要处于不 同的IP子网）。但如果一台电脑的“拨号网络适配器”（相当于一块软网卡）的TCP/IP设置中，设置了一个与网卡IP地址处于同一子网的IP地址，这 样，在IP层协议看来，这台主机就有两个不同的接口处于同一网段内。当从这台主机Ping其他的机器时，会存在这样的问题：
    A.主机不知道将数据包发到哪个网络接口，因为有两个网络接口都连接在同一网段。
    B.主机不知道用哪个地址作为数据包的源地址。因此，从这台主机去Ping其他机器，IP层协议会无法 处理，超时后，Ping 就会给出一个“超时无应答”的错误信息提示。但从其他主机Ping这台主机时，请求包从特定的网卡来，ICMP只须简单地将目的、源地址互换，并更改一些 标志即可，ICMP应答包能顺利发出，其他主机也就能成功Ping通这台机器了。 
2. Destination host Unreachable
   1. 对方与自己不在同一网段内，而自己又未设置默认的路由，比如上例中A机中不设定默认的路由，运行Ping 192.168.0.4就会出现“Destination host Unreachable”。
   2. 或者网络上根本没有这个地址：比如在上图中主机A中PING 192.168.0.7
   3. 网线出了故障,这里要说明一下“destination host unreachable”和 “time out”的区别，如果所经过的路由器的路由表中具有到达目标的路由，而目标因为其他原因不可到达，这时候会出现“time out”，如果路由表中连到达目标的路由都没有，那就会出现“destination host unreachable”。
3. Bad IP address
   1. 这个信息表示您可能没有连接到DNS服务器，所以无法解析这个IP地址，也可能是IP地址不存在。
4. Unknown host——不知名主机
   1. 这种出错信息的意思是，该远程主机的名字不能被域名服务器（DNS）转换成IP地址。
   2. 故障原因可能是域名服务器有故障
   3. 或者其名字不正确
   4. 或者网络管理员的系统与远程主机之间的通信线路有故障。

### Traceroute
racert（跟踪路由）是路由跟踪实用程序，用于确定 IP 数据报访问目标所采取的路径。　　

　　通 过Traceroute我们可以知道信息从你的计算机到互联网另一端的主机是走的什么路径。当然每次数据包由某一同样的出发点（source）到达某一同 样的目的地(destination)走的路径可能会不一样，但基本上来说大部分时候所走的路由是相同的。
　　UNIX系统中，我们称之为 Traceroute,MS Windows中为Tracert。

通过向目标发送不同 IP 生存时间 (TTL) 值的“Internet 控制消息协议 (ICMP)”回应数据包，Tracert 诊断程序确定到目标所采取的路由。要求路径上的每个路由器在转发数据包之前至少将数据包上的 TTL 递减 1。数据包上的 TTL 减为 0 时，路由器应该将“ICMP 已超时”的消息发回源系统。

参数
-d
指定不对计算机名解析地址(直接返回的全是IP)，否则，需要检索是否有这个IP对应的域名，然后显示域名+IP。
-h maximum_hops
指定查找目标的跳转的最大数目。
-jcomputer-list
指定在 computer-list 中松散源路由。
-w timeout
等待由 timeout 对每个应答指定的毫秒数。
target_name
目标1. 主机域名（2. IP）。

NAT局域网中，主机到宿主主机的链路。可以看到是从NAT服务器IP中进行路由转换除去的，但是后面经过防火墙，所以出现了***

（1）有时我们traceroute 一台主机时，会看到有一些行是以星号表示的。出现这样的情况，可能是防火墙封掉了ICMP的返回信息，所以我们得不到什么相关的数据包返回数据。

（2）有时我们在某一网关处延时比较长，有可能是某台网关比较阻塞，也可能是物理设备本身的原因。当然如果某台DNS出现问题时，不能解析主机名、域名时，也会 有延时长的现象；您可以加-n 参数来避免DNS解析，以IP格式输出数据。

（3）如果在局域网中的不同网段之间，我们可以通过traceroute 来排查问题所在，是主机的问题还是网关的问题。如果我们通过远程来访问某台服务器遇到问题时，我们用到traceroute 追踪数据包所经过的网关


### host
host,常用来分析域名的工具。可以测试域名系统是否正常。
　　目前只有linux系统中提供host命令。

（1）显示域名的所有iP
　　host 域名
　　（1）显示其他的域名，（2）显示所有有效的IP，（3）测试一个域名是否是另一个域名的别名
（2）要显示地址为 202.106.121.66 的主机名

Win之nslookup:   name Search -- ns
　　Nslookup 是一个监测网络中DNS服务器是否能正确实现域名解析的命令行工具。它在 Windows NT/2000/XP(在之后的windows系统也都可以用的，比如win7,win8等) 中均可使用,

### tcpdump
tcpdump必须使用root的身份启动。tcpdump是一个用于截取网络分组，并输出分组内容的工具。tcpdump凭借强大的功能和灵活的截取策略，使其成为类UNIX系统下用于网络分析和问题排查的首选工具。 tcpdump提供了源代码，公开了接口，因此具备很强的可扩展性，对于网络维护和入侵者都是非常有用的工具。
　　根据使用者的定义对网络上的数据包进行截获的包分析工具。 tcpdump可以将网络中传送的数据包的“头”完全截获下来提供分析。它支持针对网络层、协议、主机、网络或端口的过滤，并提供and、or、not等逻辑语句来帮助你去掉无用的信息。

tcpdump [ -adeflnNOpqStvx ] [ -c 数量 ] [ -F 文件名 ][ -i 网络接口 ] [ -r 文件名] [ -s snaplen ][ -T 类型 ] [ -w 文件名 ] [表达式 ]
一般我们的服务器里边只有一个网卡，使用tcpdump可以直接抓取数据包，但是这样查看太麻烦了，所以都会添加参数来进行获取的。
（1）参数选项
-a 　将网络地址和广播地址转变成名字；
-d 　将匹配信息包的代码以人们能够理解的汇编格式给出；
-dd 　将匹配信息包的代码以c语言程序段的格式给出；
-ddd 　将匹配信息包的代码以十进制的形式给出；
-e 　在输出行打印出数据链路层的头部信息；
-f 　将外部的Internet地址以数字的形式打印出来；
-l 　使标准输出变为缓冲行形式；
-n 　不把网络地址转换成名字；
-nn　　直接以IP和Port端口号显示，不适用主机域名与服务名显示。
-X　　直接列出hex以及ASCII，显示16进制，以及ASCII数据包的内容，这样可以监听数据包的内容。
-t 　在输出的每一行不打印时间戳；
-v 　输出一个稍微详细的信息，例如在ip包中可以包括ttl和服务类型的信息；
-vv 　输出详细的报文信息；
-c 　在收到指定的包的数目后，tcpdump就会停止；
-F 　从指定的文件中读取表达式,忽略其它的表达式；
-i 　指定监听的网络接口； 本主机;eth0
-r 　从指定的文件中读取包(这包一般通过-w选项产生)；
-w 　直接将包写入文件中，并不分析和打印出来；
-T 　将监听到的包直接解释为指定的类型的报文，常见的类型有rpc （远程过程调用）和snmp（简单　网络管理协议；）
（2）表达式
　　表达式是一个正则表达式，tcpdump利用它作为过滤报文的条件，如果一个报文满足表达式的条件，则这个报文将会被捕获。如果没有给出任何条件，则网络上所有的信息包将会被截获。
　　在表达式中一般如下几种类型的关键字：
1. 一种是关于类型的关键字，主要包括host，net，port, 
　　如下，如果没有指定类型，缺省的类型是host.
　　 host 210.27.48.2，指明 210.27.48.2是一台主机
　　net 202.0.0.0 指明202.0.0.0是一个网络地址　　
　　port 23　　 指明端口号是23。
2. 第二种是确定传输方向的关键字，主要包括src , dst ,dst or src, dst and src ,这些关键字指明了传输的方向。
　　如下，如果没有指明方向关键字，则缺省是src or dst关键字。
　　src 210.27.48.2 ,指明ip包中源地址是210.27.48.2  
　　dst net 202.0.0.0 指明目的网络地址是202.0.0.0 
3. 第三种是协议的关键字，主要包括fddi,ip ,arp,rarp,tcp,udp等类型。
　　Fddi指明是在FDDI(分布式光纤数据接口网络)上的特定的网络协议，实际上它是"ether"的别名，fddi和ether具有类似的源地址和目的地址，所以可以将fddi协议包当作ether的包进行处理和分析。其他的几个关键字就是指明了监听的包的协议内容。如果没有指定任何协议，则tcpdump将会
监听所有协议的信息包。
 
4. 除了这三种类型的关键字之外，其他重要的关键字如下：gateway, broadcast,less,greater,还有三种逻辑运算，取非运算是 'not ' '! ', 与运算是'and','&&';或运算 是'or' ,'||'；
　　这些关键字可以组合起来构成强大的组合条件来满足人们的需要，下面举几个例子来
　　说明。
(1)想要截获所有210.27.48.1 的主机收到的和发出的所有的数据包：
#tcpdump host 210.27.48.1
(2) 想要截获主机210.27.48.1 和主机210.27.48.2 或210.27.48.3的通信，使用命令：（在命令行中适用括号时，一定要带向转义\
#tcpdump host 210.27.48.1 and \ (210.27.48.2 or 210.27.48.3 \)
(3) 如果想要获取主机210.27.48.1除了和主机210.27.48.2之外所有主机通信的ip包，使用命令：
#tcpdump ip host 210.27.48.1 and ! 210.27.48.2
(4)如果想要获取主机210.27.48.1接收或发出的telnet包，使用如下命令：
#tcpdump tcp port 23 host 210.27.48.1
（5）对本机的udp 123 端口进行监视 123 为ntp的服务端口 
tcpdump udp port 123 
（6） 监视指定网络的数据包
　　打印本地主机与Berkeley网络上的主机之间的所有通信数据包(nt: ucb-ether, 此处可理解为'Berkeley网络'的网络地址,此表达式最原始的含义可表达为: 打印网络地址为ucb-ether的所有数据包)
tcpdump net ucb-ether
　　打印所有通过网关snup（IP）的ftp数据包(注意, 表达式被单引号括起来了, 这可以防止shell对其中的括号进行错误解析)
tcpdump 'gateway snup and (port ftp or ftp-data)'
打印所有源地址或目标地址是本地主机的IP数据包(如果本地网络通过网关连到了另一网络, 则另一网络并不能算作本地网络.(nt: 此句翻译曲折,需补充).localnet 实际使用时要真正替换成本地网络的名字)
tcpdump ip and not net localnet
（7）我截取本机（192.168.31.147）和主机114.114.114.114之间的数据 
tcpdump -n -i eth0 host 192.168.31.147 and 114.114.114.114
（8）截取全部进入服务器的数据可以使用以下的格式
tcpdump -n -i eth0 dst 192.168.31.147
或者服务器有多个IP 可以使用参数
tcpdump -n -i eth0 dst 192.168.31.147  or  192.168.31.157
（9）抓取全部进入服务器的TCP数据包使用以下的格式，大家可以参考下
 tcpdump -n -i eth0 dst 192.168.31.147 or 192.168.31.157 and tcp
从本机出去的数据包
tcpdump -n -i eth0 src 192.168.31.147 or 192.168.31.157
tcpdump -n -i eth0 src 192.168.31.147 or 192.168.31.157 and port ! 22 and tcp

### ping ip, arp -n
ping -c 4 ip;
　arp -n ；
执行上述命令后，即可获取对方Ip所在的网卡地址，即MAC

检查本机网络协议是否正确：# ping -c 3 127.0.0.1
检查本机网卡链路是否正确：# ping -c 3 192.168.0.1(本机IP地址)
检查网关是否正确：       # ping -c 3 192.168.0.254(网关IP地址)
检查外部连通性：        # ping -c 3 www.google.com.hk
检查硬件
 
重新启动服务
service network restart
或者
/etc/init.d/network restart

## 网关(Gateway)
网关在网络层以上实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。网关既可以用于广域网互连，也可以用于局域网互连。 网关是一种充当转换重任的计算机系统或设备。使用在不同的通信协议、数据格式或语言，甚至体系结构完全不同的两种系统之间，网关是一个翻译器。与网桥只是简单地传达信息不同，网关对收到的信息要重新打包，以适应目的系统的需求

（1）网关有双重身份：对内局域网有内部的IP，对外有外部的IP（对外可以看做一个外网的公用IP）；

（2）网关，不等效为称为网络接口,二者是不同的概念：
网关：指内网中的所有需要访问外部的IP，都需要通过这个关口，与外界相连。而外界也必须通过这个端口，进入内部网络。这两个往往不是同一个地址。一个网段中的所有IP，只有一个网关，但是有非常多的“网络接口”。
网络接口：一般选择本网段的首个可以的IP作为内网网段的所有IP的网关（一般都是末尾为1，级192.168.134.1），这是内网的网络接口。即在本路由表中，所有发送给此网段的IP都通过这个“网络接口”进入此网段。一般网络接口的概念只出现在“路由表中”，不同的路由表中的不同网段的“网络接口”必然不同。

（3）默认网关必须是电脑自己所在的网段中的IP地址，而不能填写其他网段中的IP地址
　　默认网关，就是所有所有的访问外网的IP，都通过转发给此“网关”，除去。
　　一般采用本网段中的最后一个IP作为本网段的网关（对外出口）；

（4）一般需要考虑局域网的“架构类型”，一般“集线型”。
　　一般都是采用“集线器”组件“集线型”。
　　每个局域网中的主机的都有一个网关，与外部网络连通。 但是每一个内部网络的主机的都会讲所有的外部IP转发到“网关IP”。


## 版本控制

| Version | Action                   | Time       |
| ------- | ------------------------ | ---------- |
| 1.0     | Init                     | 2019-04-29T12:30:27-07:00|
